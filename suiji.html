<!doctype html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>随机数生成器</title><link rel="stylesheet" href="https://fonts.loli.net/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200"><style>:root{--md-primary:#6750A4;--md-on-primary:#FFFFFF;--md-primary-container:#EADDFF;--md-on-primary-container:#21005D;--md-secondary:#625B71;--md-on-secondary:#FFFFFF;--md-secondary-container:#E8DEF8;--md-on-secondary-container:#1D192B;--md-surface:#FFFBFE;--md-on-surface:#1C1B1F;--md-surface-variant:#E7E0EC;--md-on-surface-variant:#49454F;--md-outline:#79747E;--md-shadow:#000000}*{box-sizing:border-box;margin:0;padding:0;font-family:'Roboto',sans-serif}body{background-color:var(--md-surface);color:var(--md-on-surface);padding:20px;max-width:800px;margin:0 auto}.container{display:flex;flex-direction:column;gap:24px}h1{color:var(--md-primary);text-align:center;padding:16px;background-color:var(--md-primary-container);border-radius:16px;cursor:pointer;user-select:none;transition:all 0.2s ease;box-shadow:0 1px 3px rgba(0,0,0,0.12),0 1px 2px rgba(0,0,0,0.24)}h1:active{transform:scale(0.98);box-shadow:0 1px 2px rgba(0,0,0,0.16),0 1px 1px rgba(0,0,0,0.22)}.settings-panel{display:flex;flex-direction:column;gap:16px;padding:16px;background-color:var(--md-surface-variant);border-radius:12px}.input-group{display:flex;flex-direction:column;gap:8px}label{font-weight:500;color:var(--md-on-surface-variant)}input,select{padding:12px 16px;border-radius:8px;border:1px solid var(--md-outline);background-color:var(--md-surface);color:var(--md-on-surface);font-size:16px}button{padding:12px 24px;border-radius:100px;border:none;background-color:var(--md-primary);color:var(--md-on-primary);font-weight:500;font-size:16px;cursor:pointer;transition:all 0.2s ease;box-shadow:0 1px 3px rgba(0,0,0,0.12),0 1px 2px rgba(0,0,0,0.24)}button:hover{box-shadow:0 3px 6px rgba(0,0,0,0.16),0 3px 6px rgba(0,0,0,0.23)}button:active{transform:translateY(2px);box-shadow:0 1px 2px rgba(0,0,0,0.16),0 1px 1px rgba(0,0,0,0.22)}.result-container{margin-top:24px;padding:16px;background-color:var(--md-secondary-container);border-radius:12px;min-height:100px}.result-numbers{display:flex;flex-wrap:wrap;gap:8px;margin-top:12px}.number-badge{padding:8px 12px;background-color:var(--md-primary);color:var(--md-on-primary);border-radius:16px;font-weight:500}.name-badge{padding:8px 12px;background-color:var(--md-secondary);color:var(--md-on-secondary);border-radius:16px;font-weight:500}.modal{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background-color:rgba(0,0,0,0.5);justify-content:center;align-items:center;z-index:1000}.modal-content{background-color:var(--md-surface);padding:24px;border-radius:16px;width:90%;max-width:500px;display:flex;flex-direction:column;gap:16px;max-height:80vh;overflow-y:auto}.advanced-settings{display:none;padding:16px;background-color:var(--md-surface-variant);border-radius:12px;margin-top:16px}.history-container{margin-top:24px;padding:16px;background-color:var(--md-surface-variant);border-radius:12px}.history-item{padding:8px 0;border-bottom:1px solid var(--md-outline)}.history-numbers{display:flex;flex-wrap:wrap;gap:4px;margin-top:4px}.small-badge{padding:4px 8px;background-color:var(--md-secondary-container);color:var(--md-on-secondary-container);border-radius:8px;font-size:12px}.small-name-badge{padding:4px 8px;background-color:var(--md-primary-container);color:var(--md-on-primary-container);border-radius:8px;font-size:12px}.warning-text{color:#B3261E;font-size:14px;margin-top:4px}.info-text{color:var(--md-secondary);font-size:14px;margin-top:4px;font-style:italic}.toggle-switch{position:relative;display:inline-block;width:60px;height:30px}.toggle-switch input{opacity:0;width:0;height:0}.toggle-slider{position:absolute;cursor:pointer;top:0;left:0;right:0;bottom:0;background-color:#ccc;transition:.4s;border-radius:34px}.toggle-slider:before{position:absolute;content:"";height:22px;width:22px;left:4px;bottom:4px;background-color:white;transition:.4s;border-radius:50%}input:checked + .toggle-slider{background-color:var(--md-primary)}input:checked + .toggle-slider:before{transform:translateX(30px)}.toggle-container{display:flex;align-items:center;gap:10px;margin-top:8px}.json-preview{margin-top:10px;padding:10px;background-color:var(--md-surface);border-radius:8px;border:1px solid var(--md-outline);max-height:150px;overflow-y:auto;font-family:monospace;font-size:12px}.import-section{margin-top:16px;padding-top:16px;border-top:1px solid var(--md-outline)}</style></head><body><div class="container"><h1 id="magic-button">随机数生成器</h1><div class="settings-panel"><div class="input-group"><label for="mode-select">模式选择</label><select id="mode-select"><option value="numbers">数字模式</option><option value="names">姓名模式</option></select></div><div id="number-settings"><div class="input-group"><label for="start-range">起始数字</label><input type="number" id="start-range" value="1"></div><div class="input-group"><label for="end-range">结束数字</label><input type="number" id="end-range" value="100"></div></div><div id="name-settings" style="display: none;"><div class="input-group"><label>已加载映射:<span id="mapping-count">0</span>个姓名</label><button id="import-json-btn" type="button" style="background-color: var(--md-secondary);">导入JSON映射</button></div></div><div class="input-group"><label for="count">抽取数量</label><input type="number" id="count" value="5" min="1"><div id="available-numbers-info" class="info-text"></div></div><button id="draw-button">抽取</button><button id="reset-session-button" style="background-color: var(--md-secondary);">重置当前会话</button></div><div class="result-container"><h3>抽取结果</h3><div id="probability-mode-info" class="info-text"></div><div id="result-numbers" class="result-numbers"></div><div id="result-names" class="result-numbers" style="display: none; margin-top: 12px;"></div></div><div class="history-container"><h3>历史记录</h3><div id="history-list"></div></div><div id="advanced-settings" class="advanced-settings"><h3>高级设置</h3><div class="input-group"><label for="low-prob-numbers">数字（用逗号分隔）</label><input type="text" id="low-prob-numbers" placeholder="例如: 1,2,3,4,5"></div><div class="input-group"><label for="threshold">阈值（默认3）</label><input type="number" id="threshold" value="3" min="1"></div><div class="input-group"><label>显示概率状态</label><div class="toggle-container"><label class="toggle-switch"><input type="checkbox" id="show-prob-status"><span class="toggle-slider"></span></label><span id="prob-status-label">关</span></div></div><button id="save-advanced">保存设置</button></div></div><div id="password-modal" class="modal"><div class="modal-content"><h3>请输入魔法口令</h3><input type="password" id="password-input" placeholder="输入口令"><button id="submit-password">确认</button></div></div><div id="import-modal" class="modal"><div class="modal-content"><h3>导入姓名-数字映射JSON</h3><textarea id="json-input" placeholder="[{&quot;name&quot;: &quot;张三&quot;, &quot;number&quot;: 1}, {&quot;name&quot;: &quot;李四&quot;, &quot;number&quot;: 2}]" rows="10" style="width: 100%; padding: 10px; border-radius: 8px; border: 1px solid var(--md-outline); resize: vertical;"></textarea><div class="json-preview"><h4>预览:</h4><div id="json-preview-content">暂无数据</div></div><div class="import-section"><button id="confirm-import">确认导入</button><button id="cancel-import" style="background-color: var(--md-secondary);">取消</button></div></div></div><script>function setCookie(e,t,n){let s="";if(n){const e=new Date;e.setTime(e.getTime()+24*n*60*60*1e3),s="; expires="+e.toUTCString()}document.cookie=e+"="+(t||"")+s+"; path=/"}function getCookie(e){const t=e+"=",n=document.cookie.split(";");for(let e=0;e<n.length;e++){let s=n[e];for(;" "===s.charAt(0);)s=s.substring(1,s.length);if(0===s.indexOf(t))return s.substring(t.length,s.length)}return null}function deleteCookie(e){document.cookie=e+"=; expires=Thu, 01 Jan 1970 00:00:01 GMT; path=/"}class PseudoRandomGenerator{constructor(){this.history=this.loadHistory(),this.settings=this.loadSettings(),this.nameMappings=this.loadNameMappings(),this.sessionDrawCount=this.loadSessionDrawCount()}loadHistory(){const e=getCookie("prng_history");return e?JSON.parse(e):[]}saveHistory(){setCookie("prng_history",JSON.stringify(this.history),30)}loadSettings(){const e=getCookie("prng_settings");return e?JSON.parse(e):{lowProbNumbers:[],threshold:3,showProbStatus:!1}}saveSettings(){setCookie("prng_settings",JSON.stringify(this.settings),30)}loadNameMappings(){const e=getCookie("prng_name_mappings");return e?JSON.parse(e):[]}saveNameMappings(){setCookie("prng_name_mappings",JSON.stringify(this.nameMappings),30)}loadSessionDrawCount(){const e=sessionStorage.getItem("prng_session_draw_count");return e?parseInt(e):0}saveSessionDrawCount(){sessionStorage.setItem("prng_session_draw_count",this.sessionDrawCount.toString())}generate(e,t,n,s){let o=[],i={};if("numbers"===s)for(let n=e;n<=t;n++)o.push(n);else{if(0===this.nameMappings.length)return{numbers:[],names:[],probabilityAdjusted:!1};this.nameMappings.forEach((e=>{o.push(e.number),i[e.number]=e.name}))}let r=!1;const a=o.length;if(this.shouldApplyProbabilityAdjustment(o,n)&&(this.adjustProbability(o),r=!0,o.length<n)){if(o.length=0,"numbers"===s)for(let n=e;n<=t;n++)o.push(n);else this.nameMappings.forEach((e=>{o.push(e.number)}));r=!1}const l=[],d=[];for(let e=0;e<n&&0!==o.length;e++){const e=Math.floor(Math.random()*o.length),t=o[e];l.push(t),"names"===s&&i[t]&&d.push(i[t]),o.splice(e,1)}return this.sessionDrawCount++,this.saveSessionDrawCount(),this.history.unshift({timestamp:(new Date).toISOString(),numbers:l,names:"names"===s?d:[],range:{start:e,end:t},mode:s,sessionCount:this.sessionDrawCount,probabilityAdjusted:r,originalRangeSize:a}),this.history.length>10&&(this.history=this.history.slice(0,10)),this.saveHistory(),{numbers:l,names:d,probabilityAdjusted:r,mode:s}}shouldApplyProbabilityAdjustment(e,t){const{lowProbNumbers:n,threshold:s}=this.settings;if(0===n.length)return!1;if(this.sessionDrawCount>=s)return!1;return n.filter((t=>e.includes(t))).length>.4*t}adjustProbability(e){const{lowProbNumbers:t}=this.settings;for(let n=e.length-1;n>=0;n--)t.includes(e[n])&&e.splice(n,1)}updateSettings(e,t,n){this.settings.lowProbNumbers=e,this.settings.threshold=t,this.settings.showProbStatus=n,this.saveSettings()}importNameMappings(e){try{if(!Array.isArray(e))throw new Error("JSON数据必须是数组");const t=e.filter((e=>e&&"string"==typeof e.name&&"number"==typeof e.number));if(0===t.length)throw new Error("未找到有效的姓名-数字映射");return this.nameMappings=t,this.saveNameMappings(),!0}catch(e){return console.error("导入姓名映射失败:",e),!1}}resetSession(){this.sessionDrawCount=0,sessionStorage.removeItem("prng_session_draw_count")}}document.addEventListener("DOMContentLoaded",(function(){const e=new PseudoRandomGenerator,t=document.getElementById("magic-button"),n=document.getElementById("draw-button"),s=document.getElementById("reset-session-button"),o=document.getElementById("password-modal"),i=document.getElementById("password-input"),r=document.getElementById("submit-password"),a=document.getElementById("advanced-settings"),l=document.getElementById("save-advanced"),d=document.getElementById("available-numbers-info"),m=document.getElementById("mode-select"),u=document.getElementById("number-settings"),c=document.getElementById("name-settings"),g=document.getElementById("result-numbers"),p=document.getElementById("result-names"),y=document.getElementById("import-json-btn"),h=document.getElementById("import-modal"),b=document.getElementById("json-input"),E=document.getElementById("json-preview-content"),v=document.getElementById("confirm-import"),f=document.getElementById("cancel-import"),I=document.getElementById("mapping-count"),B=document.getElementById("show-prob-status"),C=document.getElementById("prob-status-label");let w=0,S=0;const k=getCookie("prng_start"),M=getCookie("prng_end"),N=getCookie("prng_count"),L=getCookie("prng_mode");function _(e){"numbers"===e?(u.style.display="block",c.style.display="none",g.style.display="flex",p.style.display="none"):(u.style.display="none",c.style.display="block",g.style.display="flex",p.style.display="flex")}function x(){I.textContent=e.nameMappings.length}function T(){const t=document.getElementById("mode-select").value;let n,s;if("numbers"===t){const e=parseInt(document.getElementById("start-range").value)||1;n=(parseInt(document.getElementById("end-range").value)||100)-e+1}else n=e.nameMappings.length;s=parseInt(document.getElementById("count").value)||5,d.textContent=`可用${"numbers"===t?"数字":"姓名"}: ${n}个`,s>n&&(d.innerHTML+=`<div class="warning-text">警告: 抽取数量超过可用${"numbers"===t?"数字":"姓名"}总数！</div>`)}function A(){const t=document.getElementById("history-list");t.innerHTML="",0!==e.history.length?e.history.forEach((e=>{const n=document.createElement("div");n.className="history-item";const s=new Date(e.timestamp).toLocaleString(),o=e.sessionCount?` (会话第${e.sessionCount}次)`:"",i="names"===e.mode?"[姓名]":"[数字]",r=e.probabilityAdjusted?'<span style="color:#6750A4;">[标准]</span>':'<span style="color:#625B71;">[标准]</span>';n.innerHTML=`\n<div>${s}${o} ${i} ${r} (${e.range.start}-${e.range.end})</div>\n<div class="history-numbers">\n`,e.numbers.forEach((e=>{n.innerHTML+=`<div class="small-badge">${e}</div>`})),"names"===e.mode&&e.names.length>0&&e.names.forEach((e=>{n.innerHTML+=`<div class="small-name-badge">${e}</div>`})),n.innerHTML+="</div>",t.appendChild(n)})):t.innerHTML="<p>暂无历史记录</p>"}k&&(document.getElementById("start-range").value=k),M&&(document.getElementById("end-range").value=M),N&&(document.getElementById("count").value=N),L&&(document.getElementById("mode-select").value=L,_(L)),document.getElementById("low-prob-numbers").value=e.settings.lowProbNumbers.join(","),document.getElementById("threshold").value=e.settings.threshold,B.checked=e.settings.showProbStatus,C.textContent=e.settings.showProbStatus?"开":"关",x(),T(),A(),m.addEventListener("change",(function(){_(this.value),T()})),document.getElementById("start-range").addEventListener("input",T),document.getElementById("end-range").addEventListener("input",T),document.getElementById("count").addEventListener("input",T),B.addEventListener("change",(function(){C.textContent=this.checked?"开":"关"})),b.addEventListener("input",(function(){try{const e=JSON.parse(this.value||"[]");Array.isArray(e)&&(E.innerHTML=e.map((e=>`<div>${e.name||"未知"} -> ${e.number||"未知"}</div>`)).join("")||"<div>暂无数据</div>")}catch(e){E.innerHTML='<div style="color: red;">JSON格式错误</div>'}})),y.addEventListener("click",(function(){h.style.display="flex"})),v.addEventListener("click",(function(){try{const t=JSON.parse(b.value||"[]");e.importNameMappings(t)?(alert("姓名映射导入成功！"),h.style.display="none",x(),T()):alert("导入失败，请检查数据格式")}catch(e){alert("JSON解析错误: "+e.message)}})),f.addEventListener("click",(function(){h.style.display="none"})),t.addEventListener("click",(function(){const e=(new Date).getTime();e-S>2e3&&(w=0),w++,S=e,w>=3&&(o.style.display="flex",w=0)})),r.addEventListener("click",(function(){"123"===i.value?(o.style.display="none",a.style.display="block"):alert("口令错误！"),i.value=""})),l.addEventListener("click",(function(){const t=document.getElementById("low-prob-numbers").value.split(",").map((e=>parseInt(e.trim()))).filter((e=>!isNaN(e))),n=parseInt(document.getElementById("threshold").value)||3,s=document.getElementById("show-prob-status").checked;e.updateSettings(t,n,s),alert("高级设置已保存！")})),n.addEventListener("click",(function(){const t=document.getElementById("mode-select").value;let n,s,o;if("numbers"===t)n=parseInt(document.getElementById("start-range").value),s=parseInt(document.getElementById("end-range").value);else{if(0===e.nameMappings.length)return void alert("请先导入姓名-数字映射！");const t=e.nameMappings.map((e=>e.number));n=Math.min(...t),s=Math.max(...t)}if(o=parseInt(document.getElementById("count").value),isNaN(n)||isNaN(s)||isNaN(o)||n>=s||o<=0)return void alert("请输入有效的范围和数据量！");if(o>s-n+1)return void alert("抽取数量不能超过范围数字的总数！");setCookie("prng_start",n,30),setCookie("prng_end",s,30),setCookie("prng_count",o,30),setCookie("prng_mode",t,30);!function(t){const n=document.getElementById("result-numbers"),s=document.getElementById("result-names"),o=document.getElementById("probability-mode-info");n.innerHTML="",s.innerHTML="",e.settings.showProbStatus?(t.probabilityAdjusted?(o.textContent="本次抽取应用了概率调整模式",o.style.color="#6750A4"):(o.textContent="本次抽取使用标准随机模式",o.style.color="#625B71"),o.style.display="block"):o.style.display="none";t.numbers.forEach((e=>{const t=document.createElement("div");t.className="number-badge",t.textContent=e,n.appendChild(t)})),"names"===t.mode&&t.names.length>0?(t.names.forEach((e=>{const t=document.createElement("div");t.className="name-badge",t.textContent=e,s.appendChild(t)})),s.style.display="flex"):s.style.display="none"}(e.generate(n,s,o,t)),A()})),s.addEventListener("click",(function(){e.resetSession(),alert("当前会话已重置"),A()}))}));</script></body></html>